<!DOCTYPE html>
<html id="contentContainer" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <title>Login</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">

</head>

<body th:object="${loginRequest}">

<div class="container my-5">

    <h3>Login</h3>
    <hr/>

    <form id="loginForm" th:action="@{/api/users/login}" method="post">

        <label for="username">Username:</label>
        <input class="form-control w-100 mb-4" type="text" th:field="*{username}" id="username" name="username"
               required/>

        <label for="password">Password:</label>
        <input class="form-control w-100 mb-4" type="password" th:field="*{password}" id="password" name="password"
               required/>

        <button id="loginButton" class="btn btn-primary shadow-lg" style="width: 100px;" type="submit">Login</button>

    </form>

</div>

<!--<script th:inline="javascript">-->
<!--    document.getElementById("loginForm").addEventListener("submit", function (event) {-->
<!--        event.preventDefault();-->

<!--        const formData = new FormData(event.target);-->
<!--        const username = formData.get("username");-->
<!--        const password = formData.get("password");-->

<!--        fetch("/api/users/authenticate", {-->
<!--            method: "POST",-->
<!--            headers: {-->
<!--                "Content-Type": "application/json"-->
<!--            },-->
<!--            body: JSON.stringify({-->
<!--                username: username,-->
<!--                password: password-->
<!--            })-->
<!--        })-->
<!--            .then(response => response.json())-->
<!--            .then(data => {-->
<!--                if (data.token) {-->
<!--                    var cookieValue = data.token;-->

<!--// Set the max age of the cookie to 24 hours (in seconds)-->
<!--                    var maxAgeInSeconds = 24 * 60 * 60; // 24 hours-->

<!--// Specify the domain and path attributes-->
<!--                    var domain = "localhost";-->
<!--                    var path = "/api";-->

<!--// Construct the cookie string with attributes-->
<!--                    var cookieString = "token=" + encodeURIComponent(cookieValue) +-->
<!--                        "; max-age=" + maxAgeInSeconds +-->
<!--                        "; domain=" + domain +-->
<!--                        "; path=" + path +-->
<!--                        "; secure; samesite=None";-->

<!--// Set the cookie-->
<!--                    document.cookie = cookieString;-->
<!--                    window.location.href = "/api/reports/view";-->
<!--                }else {-->
<!--                    alert("Login failed. Please check your credentials.");-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("Login error:", error);-->
<!--                alert("An error occurred during login.");-->
<!--            });-->
<!--    });-->
<!--</script>-->

<!--<script th:inline="javascript">-->
<!--    document.getElementById("loginForm").addEventListener("submit", function (event) {-->
<!--        event.preventDefault();-->

<!--        const formData = new FormData(event.target);-->
<!--        const username = formData.get("username");-->
<!--        const password = formData.get("password");-->

<!--        fetch("/api/users/authenticate", {-->
<!--            method: "POST",-->
<!--            headers: {-->
<!--                "Content-Type": "application/json"-->
<!--            },-->
<!--            body: JSON.stringify({-->
<!--                username: username,-->
<!--                password: password-->
<!--            })-->
<!--        })-->
<!--            .then(response => response.json())-->
<!--            .then(data => {-->
<!--                if (data.token) {-->

<!--                    localStorage.setItem("token", data.token);-->
<!--                    console.log(data.token);-->

<!--                    if (data.token) {-->
<!--                        // Create a new XMLHttpRequest or use Fetch API to make the API request-->
<!--                        var xhr = new XMLHttpRequest();-->
<!--                        var url = "/api/reports/view";-->

<!--                        // Open the request-->
<!--                        xhr.open("GET", url, true);-->

<!--                        // Set the "Authorization" header with the JWT token-->
<!--                        xhr.setRequestHeader("Authorization", "Bearer " + data.token);-->

<!--                        // Define the callback function for when the request is complete-->
<!--                        xhr.onload = function () {-->
<!--                            // Check the response status and handle it as needed-->
<!--                            if (xhr.status === 200) {-->
<!--                                console.log("Request was successful!");-->
<!--                                // Handle a successful response-->
<!--                                window.location.href = "/api/reports/view";-->
<!--                            } else {-->
<!--                                // Handle an error response-->
<!--                                console.error("Request failed with status: " + xhr.status);-->
<!--                            }-->
<!--                        };-->

<!--                        // Send the request-->
<!--                        xhr.send();-->
<!--                    } else {-->
<!--                        // Handle the case where the token is not available in local storage-->
<!--                        console.error("JWT token not found in local storage.");-->
<!--                    }-->

<!--                    // fetch("/api/reports/view", {-->
<!--                    //     method: "GET",-->
<!--                    //     headers: {-->
<!--                    //         "Authorization": `Bearer ${data.token}`,-->
<!--                    //     },-->
<!--                    // })-->
<!--                    //     .then((response) => response.text()) // Convert the response to text-->
<!--                    //     .then((html) => {-->
<!--                    //         // Update the content of a specific element with the received HTML-->
<!--                    //         document.getElementById("contentContainer").innerHTML = html;-->
<!--                    //     })-->
<!--                    //     .catch((error) => {-->
<!--                    //         console.log(error);-->
<!--                    //     });-->
<!--                } else {-->
<!--                    alert("Login failed. Please check your credentials.");-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("Login error:", error);-->
<!--                alert("An error occurred during login.");-->
<!--            });-->
<!--    });-->
<!--</script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

</body>

</html>
